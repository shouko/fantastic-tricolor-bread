!function(e){var t={};function n(i){if(t[i])return t[i].exports;var c=t[i]={i:i,l:!1,exports:{}};return e[i].call(c.exports,c,c.exports,n),c.l=!0,c.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var c in e)n.d(i,c,function(t){return e[t]}.bind(null,c));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([,function(e,t,n){const i=n(2),c=n(3),{fetchTracksById:r}=n(4),{setSubtitle:a}=n(5),o=new i(e=>{if("change"===e.type){const{id:t,...n}=e.detail;a({...n,default:!0})}}),s=new c(e=>{"click"===e.type&&o.toggleShow()});async function l(){o.inject(),s.inject();const e=document.querySelector("[ref=video]");if(!e)return;const t=e.getAttribute("episodeid"),n=await r(t);o.replaceTracks(n),n.length>0&&o.change(0)}new MutationObserver(e=>{let t=0;for(let n=0;n<e.length;n+=1){const{target:i}=e[n];if("div"===i.localName?i.classList.contains("VideoPlayer__Option")&&!i.classList.contains("VideoPlayer__Option--active")&&(o.hide(),t+=1):"video"===i.localName&&i.classList.contains("VideoPlayer__Video")&&(l(),t+=1),2===t)break}}).observe(document.querySelector("main"),{attributes:!0,subtree:!0}),l()},function(e,t){const n="VideoPlayer__QualitySetting",i=n+"--active";class c{constructor(e){this.callback=e,this.tracks=[],this.tracksEl=document.createElement("ul"),this.activeTrack=null,this.el=c.createContainer(),this.el.append(this.tracksEl)}static createContainer(){const e=document.createElement("div");e.classList.add(n+"Title"),e.innerText="字幕";const t=document.createElement("div");return t.classList.add(n),t.style.marginRight="50px",t.appendChild(e),t}static createItemEl(e,t,n){const i=document.createElement("li");return i.dataset.id=t,i.innerText=e.label,i.classList.add("VideoPlayer__QualitySelector"),i.addEventListener("click",e=>{n.change(Number.parseInt(e.target.dataset.id,10))}),i}inject(){if(document.contains(this.el))return;const e=document.querySelector("[ref=videoPlayerContainer]"),t=document.querySelector("[ref=videoPlayerContainer] > .VideoPlayer__QualitySetting");e&&t&&e.insertBefore(this.el,t)}appendTracks(e){e.forEach(e=>{const t=this.tracks.length;this.tracks.push(e),this.tracksEl.appendChild(c.createItemEl(e,t,this))})}replaceTracks(e){this.tracks=[],this.tracksEl.innerHTML="",this.appendTracks(e),this.activeTrack=0}change(e){this.activeTrack=e;const t=this.tracksEl.children;for(let n=0;n<t.length;n+=1)n===e?t[n].classList.add("VideoPlayer__QualitySelector--active"):t[n].classList.remove("VideoPlayer__QualitySelector--active");this.callback(new CustomEvent("change",{detail:this.tracks[e]}))}show(){this.el.classList.add(i)}hide(){this.el.classList.remove(i)}toggleShow(){this.el.classList.contains(i)?this.hide():this.show()}}e.exports=c},function(e,t){class n{constructor(e){this.callback=e;const t=n.createIcon(),i=n.createIconContainer();i.appendChild(t);const c=document.createElement("div");c.classList.add("VideoPlayer__GearIcon"),c.addEventListener("click",()=>{this.callback(new Event("click"))}),c.appendChild(i),this.el=c}static createIcon(){const e=document.createElement("div");e.innerText="字";return Object.entries({margin:"0 auto",height:"30px",width:"20px",fontSize:"20px"}).forEach(([t,n])=>{e.style[t]=n}),e}static createIconContainer(){const e=document.createElement("div");return e.classList.add("SvgIcon"),e.classList.add("SvgIcon--default"),e.classList.add("SvgIcon--medium"),e}inject(){if(document.contains(this.el))return;const e=document.querySelector(".VideoPlayer__Option"),t=document.querySelector(".VideoPlayer__Option > .VideoPlayer__GearIcon");e&&t&&e.insertBefore(this.el,t)}}e.exports=n},function(e,t){let n="https://ichigo-milk-api.herokuapp.com";async function i(e){const t=await fetch(e.src).then(e=>e.text()),n=new Blob([t],{type:"text/vtt"});return{...e,src:URL.createObjectURL(n)}}e.exports={fetchTracksById:async function(e){const{subtitles:t}=await fetch(`${n}/episode/${Number.parseInt(e,10)}`).then(e=>e.json());return Promise.all(t.map(i))},setEndpoint:function(e){n=e}}},function(e,t){function n(){return document.querySelector("[ref=videoPlayerContainer] > video")}function i(e){const t=n();if(!t)return;let i=t.firstElementChild;for(;i;)t.removeChild(i),i=t.firstElementChild;!function(e){const t=n();t&&t.appendChild(e)}(e)}e.exports={setSubtitle:function(e){i(function(e){const t=document.createElement("track");return t.kind="subtitles",t.type="text/vtt",Object.entries(e).forEach(([e,n])=>{t[e]=n}),t}(e))}}}]);