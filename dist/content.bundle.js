!function(t){var e={};function n(r){if(e[r])return e[r].exports;var c=e[r]={i:r,l:!1,exports:{}};return t[r].call(c.exports,c,c.exports,n),c.l=!0,c.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var c in t)n.d(r,c,function(e){return t[e]}.bind(null,c));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=2)}([function(t,e){function n(){return document.querySelector("[ref=videoPlayerContainer] > video")}function r(t){const e=n();if(!e)return;let r=e.firstElementChild;for(;r;)e.removeChild(r),r=e.firstElementChild;!function(t){const e=n();e&&t.src&&e.appendChild(t)}(t)}t.exports={setSubtitle:function(t){r(function(t){const e=document.createElement("track");return e.kind="subtitles",e.type="text/vtt",Object.entries(t).forEach(([t,n])=>{e[t]=n}),e}(t))},textToBlobURL:function(t){const e=new Blob([t],{type:"text/vtt"});return URL.createObjectURL(e)},srtToVtt:function(t){return["WEBVTT",...t.trim().split("\n\n").map(t=>{const[,e,...n]=t.split("\n");return[e.replace(/,/g,"."),...n].join("\n")}),""].join("\n\n")}}},,function(t,e,n){const r=n(3),c=n(4),{fetchTracksById:i}=n(5),{setSubtitle:a}=n(0),o=new r(t=>{if("change"===t.type){const{id:e,...n}=t.detail;a({...n,default:!0})}}),s=new c(t=>{"click"===t.type&&o.toggleShow()});async function l(){o.inject(),s.inject();const t=document.querySelector("[ref=video]");if(!t)return;o.appendTracks([{label:"処理中..."}]);const e=t.getAttribute("episodeid"),n=await i(e);o.replaceTracks(n),n.length>0?o.change(0):o.change(-1)}new MutationObserver(t=>{let e=0;for(let n=0;n<t.length;n+=1){const{target:r}=t[n];if("div"===r.localName?r.classList.contains("VideoPlayer__Option")&&!r.classList.contains("VideoPlayer__Option--active")&&(o.hide(),e+=1):"video"===r.localName&&r.classList.contains("VideoPlayer__Video")&&(l(),e+=1),2===e)break}}).observe(document.querySelector("body"),{attributes:!0,subtree:!0}),l()},function(t,e,n){const{textToBlobURL:r,srtToVtt:c}=n(0),i="VideoPlayer__QualitySetting",a=i+"--active",o={id:-1,label:"オフ"},s={id:-2,label:"ファイル選択"};class l{constructor(t){this.callback=t,this.tracks=[],this.tracksEl=document.createElement("ul"),this.activeTrack=null,this.el=l.createContainer(),this.el.append(this.tracksEl)}static createContainer(){const t=document.createElement("div");t.classList.add(i+"Title"),t.innerHTML='字幕&nbsp;<a href="https://github.com/shouko/fantastic-tricolor-bread/blob/master/CONTRIBUTING.md" style="color: cyan;" target="_blank">[?]</a>';const e=document.createElement("div");return e.classList.add(i),e.style.marginRight="50px",e.appendChild(t),e}static createItemEl(t,e,n){const r=document.createElement("li");return r.dataset.id=e,r.innerText=t.label,r.classList.add("VideoPlayer__QualitySelector"),r.addEventListener("click",t=>{n.change(Number.parseInt(t.target.dataset.id,10))}),r}inject(){if(document.contains(this.el))return;const t=document.querySelector("[ref=videoPlayerContainer]"),e=document.querySelector("[ref=videoPlayerContainer] > .VideoPlayer__QualitySetting");t&&e&&t.insertBefore(this.el,e)}appendTracks(t){t.forEach(t=>{const e=this.tracks.length;this.tracks.push(t),this.tracksEl.appendChild(l.createItemEl(t,e,this))})}replaceTracks(t){this.tracks=[],this.tracksEl.innerHTML="",this.tracksEl.appendChild(l.createItemEl({label:o.label},o.id,this)),this.tracksEl.appendChild(l.createItemEl({label:s.label},s.id,this)),this.appendTracks(t),this.activeTrack=0}importCustomTrack(){const t=document.createElement("input");t.type="file",t.accept=".srt,.vtt,text/vtt",t.onchange=t=>{if(0===t.target.files.length)return;const e=t.target.files[0],n=new FileReader;n.readAsText(e,"UTF-8"),n.onload=t=>{let{result:n}=t.target;e.name.endsWith(".srt")&&(n=c(n));const i=this.tracks.length;this.appendTracks([{label:"Track "+i,src:r(n)}]),this.change(i)}},t.click()}getTrackData(t){return t===o.id?{}:this.tracks[t]}change(t){if(t===s.id)return void this.importCustomTrack();this.activeTrack=t;const e=this.tracksEl.children;for(let n=0;n<e.length;n+=1)Number.parseInt(e[n].dataset.id,10)===t?e[n].classList.add("VideoPlayer__QualitySelector--active"):e[n].classList.remove("VideoPlayer__QualitySelector--active");this.callback(new CustomEvent("change",{detail:this.getTrackData(t)}))}show(){this.el.classList.add(a)}hide(){this.el.classList.remove(a)}toggleShow(){this.el.classList.contains(a)?this.hide():this.show()}}t.exports=l},function(t,e){class n{constructor(t){this.callback=t;const e=n.createIcon(),r=n.createIconContainer();r.appendChild(e);const c=document.createElement("div");c.classList.add("VideoPlayer__GearIcon"),c.addEventListener("click",()=>{this.callback(new Event("click"))}),c.appendChild(r),this.el=c}static createIcon(){const t=document.createElement("div");t.innerText="字";return Object.entries({margin:"0 auto",height:"30px",width:"20px",fontSize:"20px"}).forEach(([e,n])=>{t.style[e]=n}),t}static createIconContainer(){const t=document.createElement("div");return t.classList.add("SvgIcon"),t.classList.add("SvgIcon--default"),t.classList.add("SvgIcon--medium"),t}inject(){if(document.contains(this.el))return;const t=document.querySelector(".VideoPlayer__Option"),e=document.querySelector(".VideoPlayer__Option > .VideoPlayer__GearIcon");t&&e&&t.insertBefore(this.el,e)}}t.exports=n},function(t,e,n){const{textToBlobURL:r}=n(0),c=n(6);let i="https://ichigo-milk-api.herokuapp.com";async function a(t){const e=await c(t.src).then(t=>t.text());return{...t,src:r(e)}}t.exports={fetchTracksById:async function(t){try{const{subtitles:e}=await c(`${i}/episode/${Number.parseInt(t,10)}`).then(t=>t.json());return Promise.all(e.map(a))}catch(t){return[]}},setEndpoint:function(t){i=t}}},function(t,e){const n="undefined"!=typeof content&&"function"==typeof content.fetch?content.fetch:window.fetch;t.exports=n}]);